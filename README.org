* Synopsis

*Projectile Drupal* is a minor mode for working with the Drupal 7 projects in GNU Emacs.
Internally it based on [[Projectile][https://github.com/bbatsov/projectile]].

TODO: It means that you can use Projectile's commands for greping (or acking) files, run tests, switch between projects, etc.

With Projectile Drupal you are able to:

** navigate through drupal resources (modules, themes, profiles and so on)
** have project environment variables available emacs shells such as eshell
** run drush --uli

* Setup

** Installation

Eventually this might be a MELPA package.

But for now, you can do this.

#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/site-lisp/projectile-drupal")
(require 'projectile-drupal)
#+END_SRC


* Usage

** Hooking up with Projectile

To make it start alongside `projectile-mode`:

#+BEGIN_SRC emacs-lisp
(add-hook 'projectile-mode-hook 'projectile-drupal-on)
#+END_SRC

That will start it only if the current project is a Drupal project.

Probably you should read Projectile's [[https://github.com/bbatsov/projectile][README]] on setting up the completion
system, caching and indexing files. Although the default settings are quite
sensible and you should be ready to go without much tweaking.

* Interactive commands


| Command                                          | Keybinding                                 | Description                                                                                              |
|--------------------------------------------------+--------------------------------------------+----------------------------------------------------------------------------------------------------------|
| projectile-drupal-find-readme                    | <kbd>C-c d r</kbd>                         | Go to Readme file in Drupal ROOT                                                                         |
| projectile-drupal-find-site-directory            | <kbd>C-c d s</kbd>                         | Go to Drupal Root                                                                                        |
| projectile-drupal-find-theme-directory           | <kbd>C-c d T</kbd>                         | Go to base theme directory                                                                               |
| projectile-drupal-find-module-directory          | <kbd>C-c d m</kbd>                         | Go to base module directory                                                                              |
| projectile-drupal-find-custom-directory          | <kbd>C-c d c</kbd>                         | Go to custom module directory                                                                            |
| projectile-drupal-find-feature-directory         | <kbd>C-c d f</kbd>                         | Go to feature module directory                                                                           |
| projectile-drupal-find-default-directory         | <kbd>C-c d d</kbd>                         | Go to default site directory                                                                             |
| projectile-drupal-find-sites-all-directory       | <kbd>C-c d a</kbd>                         | Go to site all directory                                                                                 |
| projectile-drupal-find-settings-file-name        | <kbd>C-c d S</kbd>                         | Go to settings.php file                                                                                  |
| projectile-drupal-find-settings-local-file-name  | <kbd>C-c d l</kbd>                         | Go to local.settings.php file                                                                            |
| projectile-drupal-find-contrib-directory         | <kbd>C-c d b</kbd>                         | Go to contrib mdoule directory                                                                           |
| projectile-drupal-find-profile-theme-directory   | <kbd>C-c d t</kbd>                         | Go to profile theme directory                                                                            |
| projectile-drupal-find-profile-directory         | <kbd>C-c d p</kbd>                         | Go to profile directory                                                                                  |
| projectile-drupal-find-log                       | <kbd>C-c d o</kbd>                         | Find a log file and enable `auto-revert-tail-mode` in its buffer.                                        |
| projectile-drupal-console                        | <kbd>C-c d r</kbd>                         | Run `drupal console` command in `inf-ruby` buffer.                                                       |
| projectile-drupal-rake                           | <kbd>C-c d k</kbd>                         | Select a rake task to run using `projectile-completion-system`.                                          |
| projectile-drupal-generate                       | <kbd>C-c d t</kbd>                         | Run `drupal generate` command.                                                                           |
| projectile-drupal-goto-file-at-point             | <kbd>C-c d RET</kbd>, <kbd>C-c d g f</kbd> | Go to a file at point. Depending on the context that might be a constant, template or partial, or a gem. |

You might want to create your own keybinding for your favorite commands. For example:

#+BEGIN_SRC emacs-lisp
(define-key projectile-drupal-mode-map (kbd "s-m")   'projectile-drupal-find-model)
(define-key projectile-drupal-mode-map (kbd "s-c")   'projectile-drupal-find-controller)
(define-key projectile-drupal-mode-map (kbd "s-v")   'projectile-drupal-find-view)
(define-key projectile-drupal-mode-map (kbd "s-RET") 'projectile-drupal-goto-file-at-point)
(define-key projectile-drupal-mode-map (kbd "C-c g")  projectile-drupal-mode-goto-map)
#+END_SRC


* Beyond

Consider installing other Emacs packages that can help you working
specifically with Drupal projects such as [[https://github.com/arnested/drupal-mode][drupal-mode]].

** Templates

| Extension | Alternatives       |
|-----------+--------------------|
| erb       | [[https://github.com/fxbois/web-mode][web-mode]], [[https://github.com/purcell/mmm-mode][mmm-mode]] |
| yaml      | [[https://github.com/yoshiki/yaml-mode][yaml-mode]]          |

** Running drush

Some of the Projectile Drupal functions run the drush executable.

OS X users might want to look at [[https://github.com/purcell/exec-path-from-shell][exec-path-from-shell]].

* Miscellaneous

** [[https://github.com/eethann/emacs-behat-mink][Emacs Behat Mink Tools]]
** [[https://github.com/magit/magit][magit]] to interact with git.

* Contribution

Install [cask](https://github.com/rejeep/cask.el) if you haven't already, then:

#+BEGIN_SRC sh
$ cd /path/to/projectile-drupal
$ cask
#+END_SRC

Run all tests with:

#+BEGIN_SRC sh
$ make test
#+END_SRC

For all of them to pass you will need the `bundle` executable in your path.
